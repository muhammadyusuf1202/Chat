<!DOCTYPE html>
<html lang="uz" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GlobalChat â€” Real-time Messaging</title>
<link rel="stylesheet" href="css/style.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<!-- AUTH SCREEN -->
<div id="authScreen" class="auth-screen">
  <div class="auth-container">
    <div class="auth-logo">
      <div class="logo-icon">ğŸ’¬</div>
      <h1>GlobalChat</h1>
      <p>Dunyoning istalgan nuqtasidan uling</p>
    </div>
    <div class="auth-tabs">
      <button class="tab-btn active" id="loginTab" onclick="switchTab('login')">Kirish</button>
      <button class="tab-btn" id="registerTab" onclick="switchTab('register')">Ro'yxatdan o'tish</button>
    </div>
    <form id="loginForm" class="auth-form">
      <div class="form-group">
        <label>Foydalanuvchi nomi</label>
        <input type="text" id="loginUsername" placeholder="username" autocomplete="username" required>
      </div>
      <div class="form-group">
        <label>Parol</label>
        <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" required>
      </div>
      <button type="submit" class="btn-primary">Kirish</button>
      <div id="loginError" class="error-msg"></div>
    </form>
    <form id="registerForm" class="auth-form hidden">
      <div class="form-group">
        <label>Foydalanuvchi nomi</label>
        <input type="text" id="regUsername" placeholder="username (3-20 harf)" autocomplete="username" required>
      </div>
      <div class="form-group">
        <label>Parol</label>
        <input type="password" id="regPassword" placeholder="kamida 6 ta belgi" autocomplete="new-password" required>
      </div>
      <button type="submit" class="btn-primary">Ro'yxatdan o'tish</button>
      <div id="registerError" class="error-msg"></div>
    </form>
  </div>
</div>

<!-- MAIN APP -->
<div id="appScreen" class="app hidden">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="brand">ğŸ’¬ GlobalChat</div>
      <div class="header-actions">
        <button class="icon-btn" title="Dark/Light mode" onclick="toggleTheme()">ğŸŒ™</button>
        <button class="icon-btn" title="Profil" onclick="openProfile()">âš™ï¸</button>
        <button class="icon-btn" title="Chiqish" onclick="logout()">ğŸšª</button>
      </div>
    </div>
    <div class="current-user" id="currentUserInfo">
      <div class="user-avatar-wrap">
        <img id="myAvatar" src="" alt="" class="avatar">
        <span class="status-dot online"></span>
      </div>
      <div>
        <div class="username" id="myUsername"></div>
        <div class="status-text">Siz onlinesiz</div>
      </div>
    </div>
    <div class="sidebar-search">
      <input type="text" id="userSearch" placeholder="ğŸ” Foydalanuvchi qidirish..." oninput="filterUsers()">
    </div>
    <div class="sidebar-label">Foydalanuvchilar <span id="onlineCount" class="badge">0</span></div>
    <div class="users-list" id="usersList"></div>
  </aside>

  <!-- Chat Area -->
  <main class="chat-area">
    <div class="chat-header">
      <div class="chat-title">
        <span class="chat-icon">ğŸŒ</span>
        <div>
          <div class="chat-name">Global Chat</div>
          <div class="chat-sub" id="membersCount">0 ta a'zo</div>
        </div>
      </div>
      <div class="chat-header-actions">
        <div class="lang-select-wrap">
          <select id="langSelect" onchange="setLanguage(this.value)" title="Tarjima tili">
            <option value="uz">ğŸ‡ºğŸ‡¿ O'zbek</option>
            <option value="en">ğŸ‡ºğŸ‡¸ English</option>
            <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
            <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
            <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
            <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
            <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
            <option value="tr">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option>
            <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
          </select>
        </div>
      </div>
    </div>

    <div class="messages-container" id="messagesContainer">
      <div class="messages-loader" id="loadMore">
        <button onclick="loadMoreMessages()">Ko'proq yuklash</button>
      </div>
      <div id="messagesList"></div>
    </div>

    <div class="typing-indicator" id="typingIndicator"></div>

    <div class="message-input-area">
      <div class="emoji-bar" id="emojiBar">
        <span onclick="addEmoji('ğŸ˜€')">ğŸ˜€</span><span onclick="addEmoji('ğŸ˜‚')">ğŸ˜‚</span>
        <span onclick="addEmoji('â¤ï¸')">â¤ï¸</span><span onclick="addEmoji('ğŸ‘')">ğŸ‘</span>
        <span onclick="addEmoji('ğŸ˜®')">ğŸ˜®</span><span onclick="addEmoji('ğŸ˜¢')">ğŸ˜¢</span>
        <span onclick="addEmoji('ğŸ”¥')">ğŸ”¥</span><span onclick="addEmoji('ğŸ‰')">ğŸ‰</span>
        <span onclick="addEmoji('ğŸ‘')">ğŸ‘</span><span onclick="addEmoji('ğŸ˜')">ğŸ˜</span>
        <span onclick="addEmoji('ğŸ™')">ğŸ™</span><span onclick="addEmoji('ğŸ’ª')">ğŸ’ª</span>
        <span onclick="addEmoji('ğŸ˜')">ğŸ˜</span><span onclick="addEmoji('ğŸ¤”')">ğŸ¤”</span>
        <span onclick="addEmoji('ğŸ‘‹')">ğŸ‘‹</span><span onclick="addEmoji('âœ¨')">âœ¨</span>
      </div>
      <div class="input-row">
        <button class="icon-btn emoji-toggle" onclick="toggleEmoji()" title="Emoji">ğŸ˜Š</button>
        <textarea id="messageInput" placeholder="Xabar yozing..." rows="1"
          onkeydown="handleKeydown(event)" oninput="handleTyping()"></textarea>
        <button class="send-btn" onclick="sendMessage()" title="Yuborish">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
      </div>
    </div>
  </main>
</div>

<!-- PROFILE MODAL -->
<div id="profileModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Profil sozlamalari</h2>
      <button class="close-btn" onclick="closeProfile()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="avatar-section">
        <div class="avatar-preview">
          <img id="profileAvatar" src="" alt="">
          <label class="avatar-upload-btn" for="avatarInput">ğŸ“· Rasm o'zgartirish</label>
          <input type="file" id="avatarInput" accept="image/*" onchange="uploadAvatar(event)" hidden>
        </div>
        <div class="profile-name" id="profileName"></div>
      </div>
      <div class="form-group">
        <label>Tarjima tili (default)</label>
        <select id="profileLang" onchange="updateDefaultLang(this.value)">
          <option value="uz">ğŸ‡ºğŸ‡¿ O'zbek</option>
          <option value="en">ğŸ‡ºğŸ‡¸ English</option>
          <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
          <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
          <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
          <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
          <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
          <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
          <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
          <option value="tr">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option>
          <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
        </select>
      </div>
      <div id="adminSection" class="hidden">
        <div class="admin-title">ğŸ‘‘ Admin Panel</div>
        <div class="admin-desc">Foydalanuvchini bloklash uchun â€” foydalanuvchilar ro'yxatida ustiga bosing.</div>
      </div>
    </div>
  </div>
</div>

<!-- NOTIFICATION -->
<div id="notification" class="notification hidden"></div>

<!-- CONTEXT MENU -->
<div id="contextMenu" class="context-menu hidden">
  <button onclick="contextEdit()">âœï¸ Tahrirlash</button>
  <button onclick="contextDelete()">ğŸ—‘ï¸ O'chirish</button>
</div>

<!-- EDIT MODAL -->
<div id="editModal" class="modal hidden">
  <div class="modal-content small">
    <div class="modal-header">
      <h2>Xabarni tahrirlash</h2>
      <button class="close-btn" onclick="closeEdit()">âœ•</button>
    </div>
    <div class="modal-body">
      <textarea id="editInput" rows="4" style="width:100%;resize:vertical"></textarea>
      <button class="btn-primary" style="margin-top:12px" onclick="saveEdit()">Saqlash</button>
    </div>
  </div>
</div>

<script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
<script src="js/app.js"></script>
</body>
</html>
